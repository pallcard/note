# 后台MS权限管理
## 数据库设计
数据库使用5张表，分别是 用户表、角色表、权限表、用户角色表、角色权限表（属性省略）
![title](https://raw.githubusercontent.com/pallcard/noteImg/master/noteImg/2020/03/08/Screen%20Shot%202019-06-25%20at%2011.42.16%20AM-1583637023859.png?token=AHBYBJ3GYFIXXCLZQADJBHK6MRRF6)

## 整体思路
1. 项目启动时读取所有接口，更新权限表
2. 修改登录拦截器，判断用户权限
3. 角色、权限接口

## 优化&问题
### 问题1：MS后端启动很慢

线上部署涉及集群环境，项目启动时，多个机器会调用权限初始化（更新权限表）接口，故很慢；为了只让一个机器进行权限表的更新，故使用了分布式锁+rediskey（5min过期key）
* 只用分布式锁：第一个机器拿到锁初始化一遍释放锁，第二个应用又拿到锁，进行了初始化。
* 只用rediskey(5min过期key):可能第一个机器拿到key之后，还未设置key，第二个机器就拿到key，也会初始化多次。

### 问题2：连续多次调用登录的接口，自动注册时，会出现多个账号
1.数据库层面，使得账号名为unique，这样当第二次调用使用会出现报错，无法插入。
2.代码层面，在判断用户是否登录过时，使用分布式锁，只让用户就行一次用户插入。

### 优化1：访问速度优化
使用redis缓存优化速度，每次查询用户的拥有的权限时，现在redis里面查询，若没有再去数据库里面查询，并写入redis缓存中。

### 优化2：
添加操作日志
