# 数据库原理

## 事务
事务是指满足ACID特性的一组操作，可以通过commit提交一个事务，也可以通过rollback进行回滚。
![title](https://raw.githubusercontent.com/pallcard/noteImg/master/noteImg/2020/03/28/1585378969945-1585378970021.png)

## ACID
### 原子性
事务被事务一个不可分割的最小单元，事务的所有操作那么提交成功，要么全部失败回滚。
### 隔离性
一个事务的所有修改在最终提交之前，对于其他事务是不可见的。
### 一致性
数据库事务执行前后都保持一致性状态。
### 持久性
一旦事务提交，其所做的修改将会永远保存到数据库中。

![title](https://raw.githubusercontent.com/pallcard/noteImg/master/noteImg/2020/03/28/1585379828786-1585379828787.png)

msyql 默认自动提交模式,每个查询操作都会被当做一个事务并自动提交，可以使用start transction来开启事务。
```sql
START TRANSACTION;
# 帐号1的金额减去200， 帐号2的金额增加200
UPDATE bank SET balance = balance - 200.00 WHERE customer_id = 1;
UPDATE bank SET balance = balance + 200.00 WHERE customer_id = 2;
COMMIT;
```
1. 原子性：对于上面的两条sql语句，那么全部执行成功，要么全部回滚。
2. 隔离性：在并发情况下（事务1，事务2），若事务1执行到对balance-200，事务2去查询balance时，查到的仍是原来的balance。
3. 一致性：该事务执行前后，数据库都要是一致性状态。
4. 持久性：事务一旦执行，对数据库的修改是永久的。

## 并发一致性
如上所述，在并发情况下很难保证事务的隔离性，因此会出现以下问题。
### 丢失修改
T1和T2两个事务对一个数据进行修改，T1修改的数据可能被T2所覆盖。
![title](https://raw.githubusercontent.com/pallcard/noteImg/master/noteImg/2020/03/28/1585381221535-1585381221539.png)

### 对脏数据
T1

















