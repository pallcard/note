# 类加载机制

类是在运行期间第一次使用时动态加载的，而不是一次性加载所有类。

## 类的生命周期

![title](https://raw.githubusercontent.com/pallcard/noteImg/master/noteImg/2020/03/17/1584430862257-1584430862260.png)

## 类加载过程
包含了加载、验证、准备、解析和初始化这 5 个阶段。

### 1.加载
加载过程完成以下三件事：
1. 通过类的完全限定名称获取定义该类的二进制字节流。
2. 将该字节流表示的静态存储结构转换为方法区的运行时存储结构。
3. 在内存中生成一个代表该类的 Class 对象，作为方法区中该类各种数据的访问入口。

### 2.验证

确保 Class 文件的字节流中包含的信息符合当前虚拟机的要求，并且不会危害虚拟机自身的安全。

### 3. 准备

类变量是被 static 修饰的变量，准备阶段为类变量分配内存并设置初始值，使用的是方法区的内存
```java
// 初始化后 value为0
public static int value = 123;
```
如果类变量是常量，那么它将初始化为表达式所定义的值而不是 0。
```java
// 初始化后 value为123
public final static int value = 123;
```

### 4. 解析

将常量池的**符号引用**替换为**直接引用**的过程。

### 5. 初始化
初始化阶段才真正开始执行类中定义的 Java 程序代码。初始化阶段是虚拟机执行类构造器 <clinit>() 方法的过程。在准备阶段，类变量已经赋过一次系统要求的初始值，而在初始化阶段，根据程序员通过程序制定的主观计划去初始化类变量和其它资源。
**静态语句块只能访问到定义在它之前的类变量，定义在它之后的类变量只能赋值，不能访问**。

由于父类的 <clinit>() 方法先执行，也就意味着父类中定义的静态语句块的执行要优先于子类。

接口中不可以使用静态语句块，但仍然有类变量初始化的赋值操作，因此接口与类一样都会生成 <clinit>() 方法。但接口与类不同的是，执行接口的 <clinit>() 方法不需要先执行父接口的 <clinit>() 方法。只有当父接口中定义的变量使用时，父接口才会初始化。